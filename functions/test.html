<!DOCTYPE html>
<html>
<body>

<script src="https://www.gstatic.com/firebasejs/5.3.1/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-functions.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyAnkXEGPv1JdD80zAL-dVbwGU2jUoefVRk",
    authDomain: "new-app-233e1.firebaseapp.com",
    databaseURL: "https://new-app-233e1.firebaseio.com",
    projectId: "new-app-233e1",
    storageBucket: "new-app-233e1.appspot.com",
    messagingSenderId: "169934014494"
  };
  firebase.initializeApp(config);
  var functions = firebase.functions();
  var addExperience = firebase.functions().httpsCallable('addExperience');
  var getAllExperiences = firebase.functions().httpsCallable('getAllExperiences');
  var getMyExperiences = firebase.functions().httpsCallable('getMyExperiences');
</script>
<script src="https://cdn.firebase.com/libs/firebaseui/3.1.1/firebaseui.js"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.1.1/firebaseui.css" />
<script>
  var ui = new firebaseui.auth.AuthUI(firebase.auth());
  var uiConfig = {
    callbacks: {
      signInSuccessWithAuthResult: function(authResult, redirectUrl) {
        // User successfully signed in.
        // Return type determines whether we continue the redirect automatically
        // or whether we leave that to developer to handle.
        set_authentication_status();
        document.getElementById('sign-out').style.display = 'block';
        return false;
      },
      uiShown: function() {
        // The widget is rendered.
        // Hide the loader.
        set_authentication_status();
        document.getElementById('loader').style.display = 'none';
      }
    },
    // Will use popup for IDP Providers sign-in flow instead of the default, redirect.
    signInFlow: 'popup',
    signInSuccessUrl: '<url-to-redirect-to-on-success>',
    signInOptions: [
      // Leave the lines as is for the providers you want to offer your users.
      firebase.auth.GoogleAuthProvider.PROVIDER_ID,
      firebase.auth.FacebookAuthProvider.PROVIDER_ID,
      firebase.auth.TwitterAuthProvider.PROVIDER_ID,
      firebase.auth.GithubAuthProvider.PROVIDER_ID,
      firebase.auth.EmailAuthProvider.PROVIDER_ID,
      firebase.auth.PhoneAuthProvider.PROVIDER_ID
    ],
    // Terms of service url.
    tosUrl: '<your-tos-url>',
    // Privacy policy url.
    privacyPolicyUrl: '<your-privacy-policy-url>'
  };
  ui.start('#firebaseui-auth-container', uiConfig);
  function sign_out() {
    if (firebase.auth().currentUser) {
      firebase.auth().signOut();
      document.getElementById('sign-out').innerHTML = 'Sign In';
    } else {
      document.getElementById('sign-out').innerHTML = 'Sign Out';
      document.getElementById('sign-out').style.display = 'none';
      ui.start('#firebaseui-auth-container', uiConfig);
    }
  }
  function toAddExperience() {
    var user = firebase.auth().currentUser;
    if (user) {
      var form = document.getElementById("add_experience_form");
      var data = {
        title: form.title.value,
        description: form.description.value
      };
      addExperience(data)
      .then(function(result) {
        document.getElementById('add_experience_result').innerHTML = result.data.message;
      }).catch(function(error) {
        document.getElementById('add_experience_result').innerHTML = error.message;
      });
    } else {
      confirm("Sorry, you should sign in first.");
    }
  }
  function getExperiences() {
    var user = firebase.auth().currentUser;
    if (user) {
      getAllExperiences()
      .then(function(result) {
        document.getElementById('get_experiences_result').innerHTML =
          constructExperiences(result.data.experiences);
      }).catch(function(error) {
        document.getElementById('get_experiences_result').innerHTML = error.message;
      });
    } else {
      confirm("Sorry, you should sign in first.");
    }
  }
  function getCurrentUserExperiences() {
    var user = firebase.auth().currentUser;
    if (user) {
      getMyExperiences()
      .then(function(result) {
        document.getElementById('get_my_experiences_result').innerHTML =
          constructExperiences(result.data.experiences);
      }).catch(function(error) {
        document.getElementById('get_my_experiences_result').innerHTML = error.message;
      });
    } else {
      confirm("Sorry, you should sign in first.");
    }
  }
  function constructExperiences(experiences) {
    var res = "";
    var i;
    if (experiences.length == 0) {
      res = "No Experiences";
    }
    for (i = 0; i < experiences.length; i++) {
      res = res + "<strong>User's Name: </strong>" + experiences[i][2] +
        "<br>" + "<strong>Title: </strong>" + experiences[i][0] + "<br>" +
        "<strong>Description: </strong>" + experiences[i][1] + "<br>" +
        "<br>";
    }
    return res;
  }
</script>


<h2>HTML Forms</h2>
<p id="authentication_status"></p>

<h1>Welcome to My Awesome App</h1>
<div id="firebaseui-auth-container"></div>
<div id="loader">Loading...</div>

<button id="sign-out" style="display: none;" onclick="sign_out()">Sign Out</button>
<h2>Add Experience Form</h2>
<form id="add_experience_form">
 Title:<br>
 <input type="text" name="title" value="Title">
 <br>
 Description:<br>
 <input type="text" name="description" value="Description">
 <br><br>
 <input type="button" onclick="toAddExperience()" value="Add Experience">
</form>
<p id="add_experience_result"></p>
<br>
<h2>Get All Experiences</h2>
<button onclick="getExperiences()">Get Experiences</button>
<p id="get_experiences_result"></p>
<br>
<h2>Get My Experiences</h2>
<button onclick="getCurrentUserExperiences()">Get My Experiences</button>
<p id="get_my_experiences_result"></p>
<br>
<script>
  function set_authentication_status() {
    if (firebase.auth().currentUser) {
      document.getElementById('authentication_status').innerHTML =
        "user is authenticated: ";
    } else {
      document.getElementById('authentication_status').innerHTML =
        "user is not authenticated";
    }
  }
</script>
</body>
</html>
